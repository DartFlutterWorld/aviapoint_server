# üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–ª–∏–≤–∫–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞

## –®–∞–≥ 1: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

–ü–æ—Å–ª–µ –∑–∞–ª–∏–≤–∫–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —Ç–∞–∫ –∫–∞–∫ –∫–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ Docker –æ–±—Ä–∞–∑.

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (docker-compose.prod.yaml):

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /home/aviapoint_server  # –∏–ª–∏ –ø—É—Ç—å –∫ –≤–∞—à–µ–º—É –ø—Ä–æ–µ–∫—Ç—É

# 1. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose -f docker-compose.prod.yaml build app

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose -f docker-compose.prod.yaml up -d --no-deps app

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose -f docker-compose.prod.yaml logs -f app
```

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (docker-compose.yaml):

```bash
# –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
docker-compose build server
docker-compose up -d server
docker-compose logs -f server
```

---

## –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î, –µ—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ç–∞–±–ª–∏—Ü.

### –ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –ø–æ–¥–ø–∏—Å–∫–∏ –∏–∑ profiles):

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
psql -h localhost -U postgres -d aviapoint -f migrations/remove_subscription_fields_from_profiles.sql
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Adminer (http://localhost:8082):
1. –û—Ç–∫—Ä–æ–π—Ç–µ Adminer
2. –í—ã–±–µ—Ä–∏—Ç–µ –±–∞–∑—É `aviapoint`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "SQL-–∑–∞–ø—Ä–æ—Å"
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `migrations/remove_subscription_fields_from_profiles.sql`
5. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–≥–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π:

–ï—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∏—Ö –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –µ—â–µ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
# –û–±—ã—á–Ω–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–¥—É—Ç –≤ —Ç–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ:
psql -h localhost -U postgres -d aviapoint -f migrations/create_payments_table.sql
psql -h localhost -U postgres -d aviapoint -f migrations/create_subscriptions_table.sql
psql -h localhost -U postgres -d aviapoint -f migrations/add_subscription_fields_to_payments.sql
psql -h localhost -U postgres -d aviapoint -f migrations/remove_subscription_fields_from_profiles.sql
```

---

## –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

```bash
docker-compose -f docker-compose.prod.yaml ps
```

–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `Up` –∏–ª–∏ `Up (healthy)`

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```bash
docker-compose -f docker-compose.prod.yaml logs --tail=50 app
```

–ò—â–∏—Ç–µ:
- ‚úÖ `Server started on port 8080` - —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
- ‚ùå –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- ‚ùå –û—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API –æ—Ç–≤–µ—á–∞–µ—Ç
curl http://localhost:8080/openapi/

# –ò–ª–∏ —á–µ—Ä–µ–∑ nginx (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
curl http://localhost/openapi/
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î:

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ —É–¥–∞–ª–µ–Ω—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `profiles`:

```sql
-- –í Adminer –∏–ª–∏ psql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'profiles';
```

–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- `subscription_end_date`
- `has_active_subscription`
- `subscription_updated_at`

---

## –ë—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≤—Å–µ –≤ –æ–¥–Ω–æ–º):

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /home/aviapoint_server

# 1. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose -f docker-compose.prod.yaml build app && \
docker-compose -f docker-compose.prod.yaml up -d --no-deps app

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
psql -h localhost -U postgres -d aviapoint -f migrations/remove_subscription_fields_from_profiles.sql

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose -f docker-compose.prod.yaml logs --tail=20 app
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ!

1. **–í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–π—Ç–µ Docker –æ–±—Ä–∞–∑** –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ Dart
   - –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª –≤–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–∑–∞
   - –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ –æ–±–Ω–æ–≤–∏—Ç –∫–æ–¥

2. **–ë–î –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å** - –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

3. **Nginx –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å** - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:
   ```bash
   docker exec aviapoint-nginx nginx -s reload
   ```

4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å:

‚ùå –ù–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å `docker-compose down` –∏ `docker-compose up` - —ç—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã  
‚ùå –ù–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –ë–î  
‚ùå –ù–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å nginx (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞)  
‚ùå –ù–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã - —Ç–æ–ª—å–∫–æ `app`

---

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

### –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose -f docker-compose.prod.yaml stop app

# 2. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ git)
git checkout HEAD~1

# 3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose -f docker-compose.prod.yaml build app
docker-compose -f docker-compose.prod.yaml up -d app
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤:

```bash
docker-compose -f docker-compose.prod.yaml logs --tail=100 app
```

---

**–ì–æ—Ç–æ–≤–æ!** –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —à–∞–≥–æ–≤ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ! üéâ

