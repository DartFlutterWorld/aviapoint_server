# Импорт аэропортов из АОПА-Россия

## Описание

Система была обновлена для работы с данными из АОПА-Россия (maps.aopa.ru). Старая таблица airports была удалена и создана новая с полями, соответствующими структуре CSV экспорта АОПА.

## Шаги для импорта данных

### 1. Убедитесь, что CSV файл находится в папке `public/`

Файл должен называться `aopa-points-export.csv` и находиться в папке `public/`.

### 2. Выполните миграцию

Миграция автоматически выполнится при следующем запуске сервера, или выполните вручную:

```bash
# Через MigrationManager (автоматически при старте сервера)
# Или вручную через psql:
psql -h localhost -U postgres -d aviapoint -f migrations/recreate_airports_table_aopa.sql
```

**⚠️ ВНИМАНИЕ:** Эта миграция удаляет все существующие данные в таблице airports!

### 3. Импортируйте данные из CSV

```bash
# Используя скрипт импорта (по умолчанию ищет файл в public/aopa-points-export.csv)
dart scripts/load_airports_from_aopa.dart

# Или укажите путь к файлу явно:
dart scripts/load_airports_from_aopa.dart --csv public/aopa-points-export.csv
```

### 4. Перегенерируйте код (если нужно)

После обновления модели может потребоваться перегенерировать код:

```bash
dart pub run build_runner build --delete-conflicting-outputs
```

## Структура новой таблицы

Новая таблица `airports` содержит следующие поля из CSV АОПА:

- **Основные данные:**
  - `is_active` - Действующий аэродром
  - `type` - Тип (Вертодром, Аэродром и т.д.)
  - `name` - Название
  - `name_eng` - Название на английском
  - `city` - Город
  - `ident` - Код аэродрома (например, HEE1)
  - `ident_ru` - Русский код (например, ХЕЕ1)
  - `country_code` - Код страны (UU-RUSSIA)
  - `country` - Страна
  - `country_eng` - Страна на английском
  - `region` - Регион
  - `region_eng` - Регион на английском
  - `coordinates_text` - КТА (текстовое представление)
  - `longitude_deg` - Долгота
  - `latitude_deg` - Широта
  - `elevation_ft` - Высота над уровнем моря
  - `ownership` - Принадлежность
  - `is_international` - Международный
  - `email` - Email
  - `website` - Web-сайт
  - `notes` - Примечание

- **Данные о ВПП:**
  - `runway_name` - Название основной ВПП
  - `runway_length` - Длина ВПП (метры)
  - `runway_width` - Ширина ВПП (метры)
  - `runway_surface` - Покрытие ВПП
  - `runway_magnetic_course` - Магнитный курс ВПП
  - `runway_lighting` - Освещение ВПП

- **Дополнительные поля:**
  - `services` - JSON объект с услугами
  - `owner_id` - ID владельца
  - `is_verified` - Проверен администрацией
  - `source` - Источник данных (по умолчанию 'aopa')

## Формат CSV

CSV файл должен использовать разделитель `;` (точка с запятой) и содержать следующие колонки:

1. Действующий
2. Тип
3. Название
4. Название [eng]
5. Город
6. Индекс
7. Индекс RU
8. Код страны
9. Страна
10. Страна [анг]
11. Регион
12. Регион [анг]
13. КТА
14. Долгота КТА
15. Широта КТА
16. Превышение
17. Принадлежность
18. Международный
19. Email
20. Web-сайт
21. Примечание
22. Название основной ВПП
23. Длина основной ВПП
24. Ширина основной ВПП
25. Покрытие основной ВПП
26. Магнитный курс основной ВПП
27. Освещение основной ВПП

## Примечания

- Скрипт импорта автоматически обрабатывает дубликаты по полю `ident` (код аэродрома)
- При конфликте обновляется существующая запись
- Пустые значения корректно обрабатываются как NULL
- Координаты парсятся с учетом запятой как разделителя десятичных знаков

